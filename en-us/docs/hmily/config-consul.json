{
  "filename": "config-consul.md",
  "__html": "<h3>Local Configuration</h3>\n<ul>\n<li>\n<p>File Name: <code>hmily.yml</code>。</p>\n</li>\n<li>\n<p>Path: The default path is the <code>resource</code> directory of the project, which can be specified by <code>-Dhmily.conf</code>, and you can also put the configuration in <code>user.dir</code> directory.\nPriority: <code>-Dhmily.conf</code> &gt; <code>user.dir</code> &gt; <code>resource</code></p>\n</li>\n<li>\n<p>The specific contents are as follows : Notice setting <code>hmily.server.configMode = consul</code></p>\n</li>\n<li>\n<p>The framework will pull the configuration according to your configured <code>consul</code>.</p>\n</li>\n</ul>\n<pre><code class=\"language-yml\"><span class=\"hljs-attr\">hmily:</span>\n  <span class=\"hljs-attr\">server:</span>\n    <span class=\"hljs-attr\">configMode:</span> <span class=\"hljs-string\">consul</span>\n    <span class=\"hljs-attr\">appName:</span> <span class=\"hljs-string\">xxxxx</span>\n\n<span class=\"hljs-attr\">remote:</span>\n  <span class=\"hljs-attr\">consul:</span>\n    <span class=\"hljs-attr\">hostAndPort:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-string\">:8500</span> <span class=\"hljs-comment\"># consul service address</span>\n    <span class=\"hljs-attr\">hostAndPorts:</span> \n    <span class=\"hljs-attr\">key:</span> <span class=\"hljs-string\">test</span> <span class=\"hljs-comment\"># the key of consul</span>\n    <span class=\"hljs-attr\">blacklistTimeInMillis:</span> <span class=\"hljs-number\">6000</span>\n    <span class=\"hljs-attr\">fileExtension:</span> <span class=\"hljs-string\">yml</span> <span class=\"hljs-comment\"># the format of the configuration of consul (properties or yml)</span>\n    <span class=\"hljs-attr\">passive:</span> <span class=\"hljs-literal\">true</span> <span class=\"hljs-comment\"># enable automatic update</span>\n\n</code></pre>\n<ul>\n<li>\n<p>Pay attention to consul service address configuration, if it is cluster, please configure hostAndPorts Nodes, configure hostAndPort to standalone mode. You have to set one of them, if the two is empty, it will adopt cluster configuration.</p>\n</li>\n<li>\n<p>And you need to add hmily configuration in the above configured key, the configuration is as follows:</p>\n</li>\n</ul>\n<pre><code class=\"language-yml\"><span class=\"hljs-attr\">hmily:</span>\n  <span class=\"hljs-attr\">config:</span>\n    <span class=\"hljs-attr\">appName:</span> \n    <span class=\"hljs-attr\">serializer:</span> <span class=\"hljs-string\">kryo</span>\n    <span class=\"hljs-attr\">contextTransmittalMode:</span> <span class=\"hljs-string\">threadLocal</span>\n    <span class=\"hljs-attr\">scheduledThreadMax:</span> <span class=\"hljs-number\">16</span>\n    <span class=\"hljs-attr\">scheduledRecoveryDelay:</span> <span class=\"hljs-number\">60</span>\n    <span class=\"hljs-attr\">scheduledCleanDelay:</span> <span class=\"hljs-number\">60</span>\n    <span class=\"hljs-attr\">scheduledPhyDeletedDelay:</span> <span class=\"hljs-number\">600</span>\n    <span class=\"hljs-attr\">scheduledInitDelay:</span> <span class=\"hljs-number\">30</span>\n    <span class=\"hljs-attr\">recoverDelayTime:</span> <span class=\"hljs-number\">60</span>\n    <span class=\"hljs-attr\">cleanDelayTime:</span> <span class=\"hljs-number\">180</span>\n    <span class=\"hljs-attr\">limit:</span> <span class=\"hljs-number\">200</span>\n    <span class=\"hljs-attr\">retryMax:</span> <span class=\"hljs-number\">10</span>\n    <span class=\"hljs-attr\">bufferSize:</span> <span class=\"hljs-number\">8192</span>\n    <span class=\"hljs-attr\">consumerThreads:</span> <span class=\"hljs-number\">16</span>\n    <span class=\"hljs-attr\">asyncRepository:</span> <span class=\"hljs-literal\">true</span>\n    <span class=\"hljs-attr\">autoSql:</span> <span class=\"hljs-literal\">true</span>\n    <span class=\"hljs-attr\">phyDeleted:</span> <span class=\"hljs-literal\">true</span>\n    <span class=\"hljs-attr\">storeDays:</span> <span class=\"hljs-number\">3</span>\n    <span class=\"hljs-attr\">repository:</span> <span class=\"hljs-string\">mysql</span>\n\n<span class=\"hljs-attr\">repository:</span>\n  <span class=\"hljs-attr\">database:</span>\n    <span class=\"hljs-attr\">driverClassName:</span> <span class=\"hljs-string\">com.mysql.jdbc.Driver</span>\n    <span class=\"hljs-attr\">url :</span>\n    <span class=\"hljs-attr\">username:</span>\n    <span class=\"hljs-attr\">password:</span>\n    <span class=\"hljs-attr\">maxActive:</span> <span class=\"hljs-number\">20</span>\n    <span class=\"hljs-attr\">minIdle:</span> <span class=\"hljs-number\">10</span>\n    <span class=\"hljs-attr\">connectionTimeout:</span> <span class=\"hljs-number\">30000</span>\n    <span class=\"hljs-attr\">idleTimeout:</span> <span class=\"hljs-number\">600000</span>\n    <span class=\"hljs-attr\">maxLifetime:</span> <span class=\"hljs-number\">1800000</span>\n  <span class=\"hljs-attr\">file:</span>\n    <span class=\"hljs-attr\">path:</span>\n    <span class=\"hljs-attr\">prefix:</span> <span class=\"hljs-string\">/hmily</span>\n  <span class=\"hljs-attr\">mongo:</span>\n    <span class=\"hljs-attr\">databaseName:</span>\n    <span class=\"hljs-attr\">url:</span>\n    <span class=\"hljs-attr\">userName:</span>\n    <span class=\"hljs-attr\">password:</span>\n  <span class=\"hljs-attr\">zookeeper:</span>\n    <span class=\"hljs-attr\">host:</span> <span class=\"hljs-string\">localhost:2181</span>\n    <span class=\"hljs-attr\">sessionTimeOut:</span> <span class=\"hljs-number\">1000</span>\n    <span class=\"hljs-attr\">rootPath:</span> <span class=\"hljs-string\">/hmily</span>\n  <span class=\"hljs-attr\">redis:</span>\n    <span class=\"hljs-attr\">cluster:</span> <span class=\"hljs-literal\">false</span>\n    <span class=\"hljs-attr\">sentinel:</span> <span class=\"hljs-literal\">false</span>\n    <span class=\"hljs-attr\">clusterUrl:</span>\n    <span class=\"hljs-attr\">sentinelUrl:</span>\n    <span class=\"hljs-attr\">masterName:</span>\n    <span class=\"hljs-attr\">hostName:</span>\n    <span class=\"hljs-attr\">port:</span>\n    <span class=\"hljs-attr\">password:</span>\n    <span class=\"hljs-attr\">maxTotal:</span> <span class=\"hljs-number\">8</span>\n    <span class=\"hljs-attr\">maxIdle:</span> <span class=\"hljs-number\">8</span>\n    <span class=\"hljs-attr\">minIdle:</span> <span class=\"hljs-number\">2</span>\n    <span class=\"hljs-attr\">maxWaitMillis:</span> <span class=\"hljs-number\">-1</span>\n    <span class=\"hljs-attr\">minEvictableIdleTimeMillis:</span> <span class=\"hljs-number\">1800000</span>\n    <span class=\"hljs-attr\">softMinEvictableIdleTimeMillis:</span> <span class=\"hljs-number\">1800000</span>\n    <span class=\"hljs-attr\">numTestsPerEvictionRun:</span> <span class=\"hljs-number\">3</span>\n    <span class=\"hljs-attr\">testOnCreate:</span> <span class=\"hljs-literal\">false</span>\n    <span class=\"hljs-attr\">testOnBorrow:</span> <span class=\"hljs-literal\">false</span>\n    <span class=\"hljs-attr\">testOnReturn:</span> <span class=\"hljs-literal\">false</span>\n    <span class=\"hljs-attr\">testWhileIdle:</span> <span class=\"hljs-literal\">false</span>\n    <span class=\"hljs-attr\">timeBetweenEvictionRunsMillis:</span> <span class=\"hljs-number\">-1</span>\n    <span class=\"hljs-attr\">blockWhenExhausted:</span> <span class=\"hljs-literal\">true</span>\n    <span class=\"hljs-attr\">timeOut:</span> <span class=\"hljs-number\">1000</span>\n\n<span class=\"hljs-attr\">metrics:</span>\n  <span class=\"hljs-attr\">metricsName:</span> <span class=\"hljs-string\">prometheus</span>\n  <span class=\"hljs-attr\">host:</span>\n  <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">9091</span>\n  <span class=\"hljs-attr\">async:</span> <span class=\"hljs-literal\">true</span>\n  <span class=\"hljs-attr\">threadCount :</span> <span class=\"hljs-number\">16</span>\n  <span class=\"hljs-attr\">jmxConfig:</span>\n</code></pre>\n<ul>\n<li>\n<p>Notice that the configurations of <code>repository</code> are extensions of SPI, you can select one from those modes, which don't have to be configured all.</p>\n</li>\n<li>\n<p><code>metrics</code> is optional; If it is not configured，it means you don't enable <code>metrics</code>.</p>\n</li>\n</ul>\n",
  "link": "\\en-us\\docs\\hmily\\config-consul.html",
  "meta": {
    "title": "Hmily-Config-Consul",
    "keywords": "hmily-config",
    "description": "Consul configuration centre mode"
  }
}