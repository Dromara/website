{
  "filename": "plugin-monitor.md",
  "__html": "<h2>Explanation</h2>\n<ul>\n<li>monitor plugin is used to monitor its own running status(JVM-related) by gateway, include request response delay, QPS, TPS, and other related metrics.</li>\n</ul>\n<h2>Technical Solutions</h2>\n<ul>\n<li>\n<p>Flow Diagram\n<img src=\"https://yu199195.github.io/images/soul/soul-metrics.png\" alt=\"\"></p>\n</li>\n<li>\n<p>Make even tracking in soul gateway by asynchronous or synchronous mode.</p>\n</li>\n<li>\n<p>The <code>prometheus</code> server pulls metrics' through http request, and then displays it by <code>Grafana</code>.</p>\n</li>\n</ul>\n<h2>Plugin Setting</h2>\n<ul>\n<li>\n<p>In <code>soul-admin</code>--&gt; plugin management-&gt; monitor, set to enable.</p>\n</li>\n<li>\n<p>Add the following configuration in the monitor plugin.</p>\n</li>\n</ul>\n<pre><code class=\"language-yaml\"><span class=\"hljs-string\">{\"metricsName\":\"prometheus\",\"host\":\"localhost\",\"port\":\"9191\",\"async\":\"true\"}</span>\n\n<span class=\"hljs-comment\"># port : Pulled ports for exposing to prometheus service.</span>\n<span class=\"hljs-comment\"># host : If not filled in, it is the host of soul Gateway.</span>\n<span class=\"hljs-comment\"># async :\"true\" is asynchronous event tracking， false is synchronous event tracking.</span>\n</code></pre>\n<ul>\n<li>If the user don't use, please disable the plugin in the backgroud.</li>\n</ul>\n<h2>Plugin Setting</h2>\n<ul>\n<li>Introduce <code>monitor</code> dependency in the pom.xml file of the gateway.</li>\n</ul>\n<pre><code class=\"language-xml\">  <span class=\"hljs-comment\">&lt;!-- soul monitor plugin start--&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.dromara<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>soul-spring-boot-starter-plugin-monitor<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${last.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n  <span class=\"hljs-comment\">&lt;!-- soul monitor plugin end--&gt;</span>\n</code></pre>\n<ul>\n<li>\n<p>Selectors and rules, please refer to: <a href=\"docs/en-us/soul/selector.md\">selector</a>。</p>\n<ul>\n<li>Only when the url is matched, the url will request event tracking.</li>\n</ul>\n</li>\n</ul>\n<h2>metrics Detail</h2>\n<ul>\n<li>\n<p>All JVM，thread，memory，and other related infomation will be made event tracking，you can add a JVM module in the Granfana' panel, and it will be fully displayed, please refer to： <a href=\"https://github.com/prometheus/jmx_exporter\">https://github.com/prometheus/jmx_exporter</a></p>\n</li>\n<li>\n<p>There are also the following custom <code>metrics</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">Name</th>\n<th style=\"text-align:left\">type</th>\n<th style=\"text-align:left\">target</th>\n<th style=\"text-align:left\">description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">request_total</td>\n<td style=\"text-align:left\">Counter</td>\n<td style=\"text-align:left\">none</td>\n<td style=\"text-align:left\">collecting all requests of Soul Gateway</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">http_request_total</td>\n<td style=\"text-align:left\">Counter</td>\n<td style=\"text-align:left\">path,type</td>\n<td style=\"text-align:left\">collecting all matched requests of monitor</td>\n</tr>\n</tbody>\n</table>\n<h2>Collect metrics</h2>\n<ul>\n<li>Users build their own <code>Prometheus</code> service, and add the following configuration in prometheus.yml file:</li>\n</ul>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">scrape_configs:</span>\n  <span class=\"hljs-comment\"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">job_name:</span> <span class=\"hljs-string\">'shardingSphere-proxy'</span>\n    <span class=\"hljs-comment\"># metrics_path defaults to '/metrics'</span>\n    <span class=\"hljs-comment\"># scheme defaults to 'http'.</span>\n    <span class=\"hljs-attr\">static_configs:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">targets:</span> <span class=\"hljs-string\">['localhost:9191']</span>\n</code></pre>\n<h2>Panel Presentation</h2>\n<p>It is recommended to use Granfana'. Users can customize the query to personalize the display panel, and we will provide the default configuration panel later.</p>\n",
  "link": "/en-us/docs/soul/plugin-monitor.html",
  "meta": {
    "title": "plugin-monitor",
    "keywords": "monitor",
    "description": "monitor plugin"
  }
}