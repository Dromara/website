{
  "filename": "configuration.md",
  "__html": "<h3>@Hmily annotation详解</h3>\n<ul>\n<li>\n<p>@Hmily  该注解为分布式事务的切面（AOP point），标识在你的rpc接口上。</p>\n</li>\n<li>\n<p>注解中confirmMethod=&quot;xxx&quot; 在Hmily分布式事务中confirm角色的方法名称。</p>\n</li>\n<li>\n<p>注解中cancelMethod=&quot;xxx&quot; 为在Hmily分布式事务中cancel角色的方法名称。</p>\n</li>\n<li>\n<p>注解中PatternEnum 在Hmily分布式事务中的模式，现在有tcc，和cc2种。</p>\n</li>\n</ul>\n<h4>特别注意：try, confirm,cancel 3个方法的参数类型必须一致。</h4>\n<h4>cc模式含义为confrim，cancel，即在try中没有任何数据的操作，只有对数据的校验，在try阶段发生异常，不会进行cancel方法的调用。</h4>\n<h3>使用配置：</h3>\n<ul>\n<li>\n<p>在接口上添加@Hmily注解（dubbo则需要填加在api接口上，springcloud则需要加在feignClient上），具体可参考demo工程。</p>\n</li>\n<li>\n<p>在接口实现上 添加@Hmily(confirmMethod = &quot;方法名称&quot;, cancelMethod = &quot;方法名称&quot;),并提供confrim，cancel方法名称，具体可参考demo工程</p>\n</li>\n</ul>\n<h3>HmilyTransactionBootstrap 详解：</h3>\n<pre><code class=\"language-xml\">  <span class=\"hljs-comment\">&lt;!-- Aspect 切面配置，是否开启AOP切面--&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">aop:aspectj-autoproxy</span> <span class=\"hljs-attr\">expose-proxy</span>=<span class=\"hljs-string\">\"true\"</span>/&gt;</span>\n  <span class=\"hljs-comment\">&lt;!--扫描框架的包--&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">context:component-scan</span> <span class=\"hljs-attr\">base-package</span>=<span class=\"hljs-string\">\"org.dromara.hmily.*\"</span>/&gt;</span>\n  <span class=\"hljs-comment\">&lt;!--启动类属性配置--&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"hmilyTransactionBootstrap\"</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.dromara.hmily.core.bootstrap.HmilyTransactionBootstrap\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"serializer\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"kryo\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoverDelayTime\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"120\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"retryMax\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"3\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"loadFactor\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"2\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"scheduledDelay\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"120\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"scheduledThreadMax\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"4\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"bufferSize\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"4096\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"consumerThreads\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"32\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"started\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"true\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"asyncThreads\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"32\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"repositorySupport\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"db\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"hmilyDbConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.dromara.hmily.common.config.HmilyDbConfig\"</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"url\"</span>\n                          <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"jdbc:mysql://192.168.1.98:3306/tcc?useUnicode=true<span class=\"hljs-symbol\">&amp;amp;</span>characterEncoding=utf8\"</span>/&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"driverClassName\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"com.mysql.jdbc.Driver\"</span>/&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"username\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"root\"</span>/&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"password\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"123456\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n</code></pre>\n<ul>\n<li>\n<p>serializer :这里我推荐使用是kroy。当然hmily也支持hessian,protostuff,jdk。在我们测试中表现为:\nkroy&gt;hessian&gt;protostuff&gt;jdk</p>\n</li>\n<li>\n<p>recoverDelayTime :定时任务延迟时间（单位是秒，默认120。这个参数只是要大于你的rpc调用的超时时间设置。</p>\n</li>\n<li>\n<p>retryMax : 最大重复次数，默认3次。当你的服务down机，定时任务会执行retryMax次数去执行你的cancel还是confrim。</p>\n</li>\n<li>\n<p>bufferSize: disruptor的bufferSize,当高并发的时候，可以调大。注意是 2n次方</p>\n</li>\n<li>\n<p>consumerThreads distuptor消费线程数量,高并发的时候，可以调大。</p>\n</li>\n<li>\n<p>started: 注意在是发起方的时候，把此属性设置为true。参与方为false。</p>\n</li>\n<li>\n<p>asyncThreads 异步执行confirm和cancel线程池线程的大小，高并发的时候请调大</p>\n</li>\n<li>\n<p>接下来是最重要的事务日志的存储 在我们的压测中，推荐使用mongo。表现为 mongodb&gt;redis集群&gt;mysql&gt;zookeeper</p>\n</li>\n<li>\n<p>如果你采用mongodb存储日志,配置如下(url可以配置成mongdb集群的url)</p>\n</li>\n</ul>\n<pre><code class=\"language-xml\">       <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"repositorySupport\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"mongodb\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"hmilyMongoConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.dromara.hmily.common.config.HmilyMongoConfig\"</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"mongoDbUrl\"</span>  <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"192.168.1.68:27017\"</span>/&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"mongoDbName\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"happylife\"</span>/&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"mongoUserName\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"xiaoyu\"</span>/&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"mongoUserPwd\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"123456\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n</code></pre>\n<ul>\n<li>\n<p>如果你采用redis存储日志,配置如下：</p>\n<ul>\n<li>redis单节点</li>\n</ul>\n</li>\n</ul>\n<pre><code class=\"language-xml\">   <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"repositorySupport\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"redis\"</span> /&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"hmilyRedisConfig\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.dromara.hmily.common.config.HmilyRedisConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"hostName\"</span>\n                      <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"192.168.1.68\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"port\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"6379\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"password\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n</code></pre>\n<ul>\n<li>\n<p>redis哨兵模式集群:</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"repositorySupport\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"redis\"</span>/&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"hmilyRedisConfig\"</span>&gt;</span>\n     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.dromara.hmily.common.config.HmilyRedisConfig\"</span>&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"masterName\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"aaa\"</span>/&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"sentinel\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"true\"</span>/&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"sentinelUrl\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"192.168.1.91:26379;192.168.1.92:26379;192.168.1.93:26379\"</span>/&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"password\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"123456\"</span>/&gt;</span>\n     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n</code></pre>\n</li>\n<li>\n<p>redis集群:</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"repositorySupport\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"redis\"</span>/&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"hmilyRedisConfig\"</span>&gt;</span>\n     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.dromara.hmily.common.config.HmilyRedisConfig\"</span>&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"cluster\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"true\"</span>/&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"clusterUrl\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"192.168.1.91:26379;192.168.1.92:26379;192.168.1.93:26379\"</span>/&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"password\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"123456\"</span>/&gt;</span>\n     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n</code></pre>\n</li>\n<li>\n<p>如果你采用zookeeper存储日志,配置如下：</p>\n</li>\n</ul>\n<pre><code class=\"language-xml\">       <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"repositorySupport\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"zookeeper\"</span>/&gt;</span>\n       <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"hmilyZookeeperConfig\"</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.dromara.hmily.common.config.HmilyZookeeperConfig\"</span>&gt;</span>\n               <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"host\"</span>  <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"192.168.1.73:2181\"</span>/&gt;</span>\n               <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"sessionTimeOut\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"100000\"</span>/&gt;</span>\n               <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"rootPath\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"/tcc\"</span>/&gt;</span>\n           <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n       <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n</code></pre>\n",
  "link": "\\zh-cn\\docs\\hmily\\configuration.html",
  "meta": {
    "title": "Hmily配置详解",
    "keywords": "configuration",
    "description": "Hmily配置详解"
  }
}