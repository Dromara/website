{
  "filename": "user-dataSync.md",
  "__html": "<h2>说明</h2>\n<ul>\n<li>\n<p>数据同步是指将 <code>soul-admin</code> 配置的数据，同步到 <code>soul</code> 集群中的JVM内存里面，是网关高性能的关键。</p>\n</li>\n<li>\n<p>实现原理，请看： <a href=\"dataSync.md\">数据同步</a>。</p>\n</li>\n<li>\n<p>文中所说的网关，是指你搭建的网关环境，请看：<a href=\"setup.md\">搭建环境</a>。</p>\n</li>\n</ul>\n<h2>websocket同步（默认方式，推荐）</h2>\n<ul>\n<li>\n<p>网关配置（记得重启）</p>\n<ul>\n<li>首先在 <code>pom.xml</code> 文件中 引入以下依赖：</li>\n</ul>\n</li>\n</ul>\n<pre><code class=\"language-xml\">   <span class=\"hljs-comment\">&lt;!--soul data sync start use websocket--&gt;</span>\n   <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.dromara<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>soul-spring-boot-starter-sync-data-websocket<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>2.2.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n   <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<ul>\n<li>在 springboot的 yml 文件中进行如下配置:</li>\n</ul>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">soul :</span>\n    <span class=\"hljs-attr\">sync:</span>\n        <span class=\"hljs-attr\">websocket :</span>\n             <span class=\"hljs-attr\">urls:</span> <span class=\"hljs-string\">ws://localhost:9095/websocket</span>\n<span class=\"hljs-comment\">#urls:是指 soul-admin的地址，如果有多个，请使用（,）分割.</span>\n</code></pre>\n<ul>\n<li>soul-admin 配置, 或在 soul-admin 启动参数中设置 <code>--soul.sync.websocket=''</code>,然后重启服务。</li>\n</ul>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">soul:</span>\n  <span class=\"hljs-attr\">sync:</span>\n     <span class=\"hljs-attr\">websocket:</span>\n</code></pre>\n<ul>\n<li>\n<p>当建立连接以后会全量获取一次数据，以后的数据都是增量的更新与新增，性能好。</p>\n</li>\n<li>\n<p>支持断线重连 （默认30秒）。</p>\n</li>\n</ul>\n<h2>zookeeper同步</h2>\n<ul>\n<li>\n<p>网关配置（记得重启）</p>\n<ul>\n<li>首先在 <code>pom.xml</code> 文件中 引入以下依赖：</li>\n</ul>\n</li>\n</ul>\n<pre><code class=\"language-xml\">   <span class=\"hljs-comment\">&lt;!--soul data sync start use zookeeper--&gt;</span>\n     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.dromara<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>soul-spring-boot-starter-sync-data-zookeeper<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>2.2.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<ul>\n<li>在 springboot的 yml 文件中进行如下配置:</li>\n</ul>\n<pre><code class=\"language-yaml\"> <span class=\"hljs-attr\">soul :</span>\n     <span class=\"hljs-attr\">sync:</span>\n         <span class=\"hljs-attr\">zookeeper:</span>\n              <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">localhost:2181</span>\n              <span class=\"hljs-attr\">sessionTimeout:</span> <span class=\"hljs-number\">5000</span>\n              <span class=\"hljs-attr\">connectionTimeout:</span> <span class=\"hljs-number\">2000</span>\n <span class=\"hljs-comment\">#url: 配置成你的zk地址，集群环境请使用（,）分隔</span>\n</code></pre>\n<ul>\n<li>soul-admin 配置, 或在 soul-admin 启动参数中设置 <code>--soul.sync.zookeeper.url='你的地址'</code>,然后重启服务。</li>\n</ul>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">soul:</span>\n  <span class=\"hljs-attr\">sync:</span>\n    <span class=\"hljs-attr\">zookeeper:</span>\n        <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">localhost:2181</span>\n        <span class=\"hljs-attr\">sessionTimeout:</span> <span class=\"hljs-number\">5000</span>\n        <span class=\"hljs-attr\">connectionTimeout:</span> <span class=\"hljs-number\">2000</span>\n</code></pre>\n<ul>\n<li>使用zookeeper同步机制也是非常好的,时效性也高，我们生产环境使用的就是这个，但是也要处理zk环境不稳定，集群脑裂等问题.</li>\n</ul>\n<h2>http长轮询同步</h2>\n<ul>\n<li>\n<p>网关配置（记得重启）</p>\n<ul>\n<li>首先在 <code>pom.xml</code> 文件中 引入以下依赖：</li>\n</ul>\n</li>\n</ul>\n<pre><code class=\"language-xml\">   <span class=\"hljs-comment\">&lt;!--soul data sync start use zookeeper--&gt;</span>\n     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.dromara<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>soul-spring-boot-starter-sync-data-http<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>2.2.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<ul>\n<li>在 springboot的 yml 文件中进行如下配置:</li>\n</ul>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">soul :</span>\n   <span class=\"hljs-attr\">sync:</span>\n       <span class=\"hljs-attr\">http:</span>\n            <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">http://localhost:9095</span>\n<span class=\"hljs-comment\">#url: 配置成你的 soul-admin的 ip与端口地址，多个admin集群环境请使用（,）分隔。</span>\n</code></pre>\n<ul>\n<li>soul-admin 配置, 或在 soul-admin 启动参数中设置 <code>--soul.sync.http=''</code>,然后重启服务。</li>\n</ul>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">soul:</span>\n  <span class=\"hljs-attr\">sync:</span>\n     <span class=\"hljs-attr\">http:</span>\n</code></pre>\n<ul>\n<li>\n<p>http长轮询使得网关很轻量，时效性略低。</p>\n</li>\n<li>\n<p>其根据分组key来拉取，如果数据量过大，过多，会有一定的影响。 什么意思呢？就是一个组下面的一个小地方更改，会拉取整个的组数据。</p>\n</li>\n<li>\n<p>在soul-admin 集群时候，可能会有bug。</p>\n</li>\n</ul>\n<h2>nacos同步</h2>\n<ul>\n<li>\n<p>网关配置（记得重启）</p>\n<ul>\n<li>首先在 <code>pom.xml</code> 文件中 引入以下依赖：</li>\n</ul>\n</li>\n</ul>\n<pre><code class=\"language-xml\">   <span class=\"hljs-comment\">&lt;!--soul data sync start use zookeeper--&gt;</span>\n     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.dromara<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>soul-spring-boot-starter-sync-data-nacos<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>2.2.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<ul>\n<li>在 springboot的 yml 文件中进行如下配置:</li>\n</ul>\n<pre><code class=\"language-yaml\"> <span class=\"hljs-attr\">soul :</span>\n     <span class=\"hljs-attr\">sync:</span>\n        <span class=\"hljs-attr\">nacos:</span>\n             <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">localhost:8848</span>\n             <span class=\"hljs-attr\">namespace:</span> <span class=\"hljs-string\">1c10d748-af86-43b9-8265-75f487d20c6c</span>\n             <span class=\"hljs-attr\">acm:</span>\n               <span class=\"hljs-attr\">enabled:</span> <span class=\"hljs-literal\">false</span>\n               <span class=\"hljs-attr\">endpoint:</span> <span class=\"hljs-string\">acm.aliyun.com</span>\n               <span class=\"hljs-attr\">namespace:</span> \n               <span class=\"hljs-attr\">accessKey:</span> \n               <span class=\"hljs-attr\">secretKey:</span> \n <span class=\"hljs-comment\">#url: 配置成你的nacos地址，集群环境请使用（,）分隔。</span>\n <span class=\"hljs-comment\"># 其他参数配置，请参考naocs官网。</span>\n</code></pre>\n<ul>\n<li>soul-admin 配置, 或在 soul-admin 启动参数中使用 <code>--</code> 的方式一个一个传值。</li>\n</ul>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">soul :</span>\n      <span class=\"hljs-attr\">sync:</span>\n         <span class=\"hljs-attr\">nacos:</span>\n              <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">localhost:8848</span>\n              <span class=\"hljs-attr\">namespace:</span> <span class=\"hljs-string\">1c10d748-af86-43b9-8265-75f487d20c6c</span>\n              <span class=\"hljs-attr\">acm:</span>\n                <span class=\"hljs-attr\">enabled:</span> <span class=\"hljs-literal\">false</span>\n                <span class=\"hljs-attr\">endpoint:</span> <span class=\"hljs-string\">acm.aliyun.com</span>\n                <span class=\"hljs-attr\">namespace:</span> \n                <span class=\"hljs-attr\">accessKey:</span> \n                <span class=\"hljs-attr\">secretKey:</span> \n</code></pre>\n",
  "link": "\\zh-cn\\docs\\soul\\user-dataSync.html",
  "meta": {
    "title": "使用不同的数据同步策略",
    "keywords": "soul",
    "description": "使用不同的数据同步策略"
  }
}