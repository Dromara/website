{
  "filename": "user-sofa.md",
  "__html": "<h2>说明</h2>\n<ul>\n<li>\n<p>此篇文章是sofa用户使用sofa插件支持，以及自己的sofa服务接入soul网关的教程。</p>\n</li>\n<li>\n<p>接入前，请正确的启动 <code>soul-admin</code>以及<a href=\"setup.md\">搭建环境</a> Ok。</p>\n</li>\n</ul>\n<h2>引入网关对sofa支持的插件</h2>\n<ul>\n<li>\n<p>在网关的 <code>pom.xml</code> 文件中增加如下依赖：</p>\n<ul>\n<li>sofa版本换成你的，注册中心的jar包换成你的，以下是参考。</li>\n</ul>\n</li>\n</ul>\n<pre><code class=\"language-xml\">\n       <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.alipay.sofa<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>sofa-rpc-all<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>5.7.6<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n       <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n       <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.curator<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>curator-client<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>4.0.1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n       <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n       <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.curator<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>curator-framework<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>4.0.1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n       <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n       <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.curator<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>curator-recipes<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>4.0.1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n       <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n       <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.dromara<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>soul-spring-boot-starter-plugin-sofa<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${last.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n       <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n\n</code></pre>\n<ul>\n<li>重启网关服务。</li>\n</ul>\n<h2>sofa服务接入网关，可以参考：(soul-test-sofa)[<a href=\"https://github.com/dromara/soul/tree/master/soul-test/soul-test-sofa\">https://github.com/dromara/soul/tree/master/soul-test/soul-test-sofa</a>]</h2>\n<ul>\n<li>\n<p>springboot</p>\n<ul>\n<li>引入以下依赖</li>\n</ul>\n</li>\n</ul>\n<pre><code class=\"language-xml\">       <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.dromara<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>soul-spring-boot-starter-client-sofa<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${soul.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n       <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<ul>\n<li>在你的yml文件中新增如下配置 ：</li>\n</ul>\n<pre><code class=\"language-yaml\">     <span class=\"hljs-attr\">soul:</span>\n       <span class=\"hljs-attr\">sofa:</span>\n         <span class=\"hljs-attr\">adminUrl:</span> <span class=\"hljs-string\">http://localhost:9095</span>\n         <span class=\"hljs-attr\">contextPath:</span> <span class=\"hljs-string\">/sofa</span>\n         <span class=\"hljs-attr\">appName:</span> <span class=\"hljs-string\">sofa</span>\n      <span class=\"hljs-comment\"># adminUrl: 为你启动的soul-admin 项目的ip + 端口，注意要加 http://</span>\n      <span class=\"hljs-comment\"># contextPath: 为你的这个项目在soul网关的路由前缀，这个你应该懂意思把？ 比如/order ，/product 等等，网关会根据你的这个前缀来进行路由.</span>\n      <span class=\"hljs-comment\"># appName：你的应用名称，不配置的话，会默认取sofa配置中application 中的名称</span>\n</code></pre>\n<ul>\n<li>\n<p>spring</p>\n<ul>\n<li>引入以下依赖 ：</li>\n</ul>\n</li>\n</ul>\n<pre><code class=\"language-xml\">       <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.dromara<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>soul-client-sofa<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${project.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n       <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<ul>\n<li>在你的 bean定义的xml文件中新增如下 ：</li>\n</ul>\n<pre><code class=\"language-xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">id</span> =<span class=\"hljs-string\">\"sofaServiceBeanPostProcessor\"</span> <span class=\"hljs-attr\">class</span> =<span class=\"hljs-string\">\"org.dromara.soul.client.sofa.SofaServiceBeanPostProcessor\"</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">constructor-arg</span>  <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">\"sofaConfig\"</span>/&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"sofaConfig\"</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.dromara.soul.client.sofa.common.config.SofaConfig\"</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"adminUrl\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"http://localhost:9095\"</span>/&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"contextPath\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"/你的contextPath\"</span>/&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"appName\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"你的名字\"</span>/&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n</code></pre>\n<h2>sofa 插件设置</h2>\n<ul>\n<li>\n<p>首先在 <code>soul-admin</code> 插件管理中，把<code>sofa</code> 插件设置为开启。</p>\n</li>\n<li>\n<p>其次在 <code>sofa</code> 插件中配置你的注册地址或者其他注册中心的地址.</p>\n</li>\n</ul>\n<pre><code class=\"language-yaml\"><span class=\"hljs-string\">{\"protocol\":\"zookeeper\",\"register\":\"127.0.0.1:2181\"}</span>\n\n</code></pre>\n<h2>接口注册到网关</h2>\n<ul>\n<li>\n<p>你sofa服务实现类的，方法上加上 @SoulSofaClient 注解，表示该接口方法注册到网关。</p>\n</li>\n<li>\n<p>启动你的提供者，输出日志 <code>sofa client register success</code> 大功告成，你的sofa接口已经发布到 soul网关.如果还有不懂的，可以参考 <code>soul-test-sofa</code>项目。</p>\n</li>\n</ul>\n<h2>sofa用户请求以及参数说明</h2>\n<ul>\n<li>\n<p>说白了，就是通过http的方式来请求你的sofa服务</p>\n</li>\n<li>\n<p>soul网关需要有一个路由前缀，这个路由前缀就是你接入项目进行配置 <code>contextPath</code></p>\n</li>\n</ul>\n<pre><code class=\"language-yaml\"><span class=\"hljs-comment\"># 比如你有一个 order服务 它有一个接口，它的注册路径 /order/test/save</span>\n\n<span class=\"hljs-comment\"># 现在就是通过 post方式请求网关：http://localhost:9195/order/test/save</span>\n\n<span class=\"hljs-comment\"># 其中 localhost:9195 为网关的ip端口，默认端口是9195 ，/order 是你sofa接入网关配置的 contextPath</span>\n\n</code></pre>\n<ul>\n<li>\n<p>参数传递：</p>\n<ul>\n<li>\n<p>通过 http post 方式访问网关，通过body，json类型传递。</p>\n</li>\n<li>\n<p>更多参数类型传递，可以参考 <a href=\"https://github.com/dromara/soul/tree/master/soul-test/soul-test-sofa\">soul-test-sofa</a> 中的接口定义，以及参数传递方式。</p>\n</li>\n</ul>\n</li>\n<li>\n<p>单个java bean参数类型 （默认）</p>\n</li>\n<li>\n<p>自定义实现多参数支持：</p>\n<ul>\n<li>在你搭建的网关项目中，新增一个类 A，实现 <code>org.dromara.soul.plugin.api.sofa.SofaParamResolveService</code>。</li>\n</ul>\n</li>\n</ul>\n<pre><code class=\"language-java\">   <span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">SofaParamResolveService</span> </span>{\n   \n       <span class=\"hljs-comment\">/**\n        * Build parameter pair.\n        * this is Resolve http body to get sofa param.\n        *\n        * <span class=\"hljs-doctag\">@param</span> body           the body\n        * <span class=\"hljs-doctag\">@param</span> parameterTypes the parameter types\n        * <span class=\"hljs-doctag\">@return</span> the pair\n        */</span>\n       Pair&lt;String[], Object[]&gt; buildParameter(String body, String parameterTypes);\n   }\n</code></pre>\n<ul>\n<li>\n<p><code>body</code>为http中body传的json字符串。</p>\n</li>\n<li>\n<p><code>parameterTypes</code>: 匹配到的方法参数类型列表，如果有多个，则使用<code>,</code>分割。</p>\n</li>\n<li>\n<p>Pair中，left为参数类型，right为参数值，这是sofa泛化调用的标准。</p>\n</li>\n<li>\n<p>把你的类注册成Spring的bean，覆盖默认的实现。</p>\n</li>\n</ul>\n<pre><code class=\"language-java\">   <span class=\"hljs-meta\">@Bean</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> SofaParamResolveService <span class=\"hljs-title\">A</span><span class=\"hljs-params\">()</span> </span>{\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> A();\n    }\n</code></pre>\n",
  "link": "/zh-cn/docs/soul/user-sofa.html",
  "meta": {
    "title": "sofa接入soul网关",
    "keywords": "sofa",
    "description": "sofa接入soul网关"
  }
}