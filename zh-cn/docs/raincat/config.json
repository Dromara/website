{
  "filename": "config.md",
  "__html": "<h3>@TxTransaction annotation详解</h3>\n<ul>\n<li>该注解为分布式事务的切面（AOP point），如果业务方的service服务需要参与分布式事务，则需要加上此注解。</li>\n</ul>\n<h3>TxTransactionBootstrap 详解：</h3>\n<pre><code class=\"language-xml\">\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">context:component-scan</span> <span class=\"hljs-attr\">base-package</span>=<span class=\"hljs-string\">\"org.dromara.raincat.*\"</span>/&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">aop:aspectj-autoproxy</span> <span class=\"hljs-attr\">expose-proxy</span>=<span class=\"hljs-string\">\"true\"</span>/&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"txTransactionBootstrap\"</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.dromara.raincat.core.bootstrap.TxTransactionBootstrap\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"txManagerUrl\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"http://localhost:8761\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"serializer\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"kryo\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"nettySerializer\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"kryo\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"bufferSize\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"4096\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"nettyThreadMax\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"16\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"refreshInterval\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"30\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"delayTime\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"30\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"heartTime\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"10\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"compensation\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"true\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoverDelayTime\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"60\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"retryMax\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"3\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"compensationRecoverTime\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"60\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"compensationCacheType\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"db\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"txDbConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.dromara.raincat.common.config.TxDbConfig\"</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"url\"</span>\n                          <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"jdbc:mysql://192.168.1.98:3306/tx?useUnicode=true&amp;amp;characterEncoding=utf8\"</span>/&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"driverClassName\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"com.mysql.jdbc.Driver\"</span>/&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"username\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"root\"</span>/&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"password\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"123456\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n</code></pre>\n<ul>\n<li>\n<p>txManagerUrl：填写你启动的txManager的ip端口，注意添加http://前缀。</p>\n</li>\n<li>\n<p>serializer :事务日志序列化方式，这里我推荐使用是kroy。当然也支持hessian,protostuff,jdk。在我们测试中表现为:\nkroy&gt;hessian&gt;protostuff&gt;jdk。</p>\n</li>\n<li>\n<p>nettySerializer： 与txManager通信对象的序列化方法，注意与txManager中的序列化方式配置一样。</p>\n</li>\n<li>\n<p>bufferSize: disruptor的bufferSize,当高并发的时候，可以调大。注意是 2n次方。</p>\n</li>\n<li>\n<p>nettyThreadMax ： netty客户端工作线程数量。</p>\n</li>\n<li>\n<p>refreshInterval: 拉取txmanager配置信息间隔时间，单位秒。</p>\n</li>\n<li>\n<p>delayTime ： 客户端与txmanager通信最大延迟时间。</p>\n</li>\n<li>\n<p>heartTime ： 与txmanager保持心跳时间间隔，单位秒。</p>\n</li>\n<li>\n<p>compensation： 是否需要补偿，一般情况下不需要，极端情况下设置为true。</p>\n<ul>\n<li>\n<p>recoverDelayTime：事务恢复延迟时间，只有当 compensation：为ture才有用。</p>\n</li>\n<li>\n<p>compensationRecoverTime： 补偿间隔时间 只有当 compensation：为ture才有用。</p>\n</li>\n<li>\n<p>retryMax ： 事务补偿最大重试次数。</p>\n</li>\n</ul>\n</li>\n<li>\n<p>compensationCacheType：使用何种方式存储日志，支持的有db，redis，mongo，zookeeper等。</p>\n</li>\n<li>\n<p>接下来是最重要的事务日志的存储 在我们的压测中，推荐使用mongo。表现为 mongodb&gt;redis集群&gt;mysql&gt;zookeeper</p>\n</li>\n<li>\n<p>如果你采用mongodb存储日志,配置如下(url可以配置成mongdb集群的url)</p>\n</li>\n</ul>\n<pre><code class=\"language-xml\">       <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"compensationCacheType\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"mongodb\"</span>/&gt;</span>\n       <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"txMongoConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.dromara.raincat.common.config.TxMongoConfig\"</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"mongoDbUrl\"</span>  <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"192.168.1.68:27017\"</span>/&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"mongoDbName\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"happylife\"</span>/&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"mongoUserName\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"xiaoyu\"</span>/&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"mongoUserPwd\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"123456\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n</code></pre>\n<ul>\n<li>\n<p>如果你采用redis存储日志,配置如下：</p>\n<ul>\n<li>redis单节点</li>\n</ul>\n</li>\n</ul>\n<pre><code class=\"language-xml\">   <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"compensationCacheType\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"redis\"</span> /&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"txRedisConfig\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.dromara.raincat.common.config.TxRedisConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"hostName\"</span>\n                      <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"192.168.1.68\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"port\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"6379\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"password\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n</code></pre>\n<ul>\n<li>\n<p>redis哨兵模式集群:</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"compensationCacheType\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"redis\"</span>/&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"txRedisConfig\"</span>&gt;</span>\n     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.dromara.hmily.common.config.TxRedisConfig\"</span>&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"masterName\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"aaa\"</span>/&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"sentinel\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"true\"</span>/&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"sentinelUrl\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"192.168.1.91:26379;192.168.1.92:26379;192.168.1.93:26379\"</span>/&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"password\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"123456\"</span>/&gt;</span>\n     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n</code></pre>\n</li>\n<li>\n<p>redis集群:</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"compensationCacheType\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"redis\"</span>/&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"txRedisConfig\"</span>&gt;</span>\n     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.dromara.hmily.common.config.TxRedisConfig\"</span>&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"cluster\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"true\"</span>/&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"clusterUrl\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"192.168.1.91:26379;192.168.1.92:26379;192.168.1.93:26379\"</span>/&gt;</span>\n         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"password\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"123456\"</span>/&gt;</span>\n     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n</code></pre>\n</li>\n<li>\n<p>如果你采用zookeeper存储日志,配置如下：</p>\n</li>\n</ul>\n<pre><code class=\"language-xml\">       <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"compensationCacheType\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"zookeeper\"</span>/&gt;</span>\n       <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"txZookeeperConfig\"</span>&gt;</span>\n           <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.dromara.hmily.common.config.TxZookeeperConfig\"</span>&gt;</span>\n               <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"host\"</span>  <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"192.168.1.73:2181\"</span>/&gt;</span>\n               <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"sessionTimeOut\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"100000\"</span>/&gt;</span>\n               <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"rootPath\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"/tcc\"</span>/&gt;</span>\n           <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n       <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n</code></pre>\n",
  "title": "TxTransactionBootstrap配置详解",
  "keywords": "configuration",
  "description": "TxTransactionBootstrap配置详解"
}